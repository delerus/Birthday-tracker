@model NearBirthdaysViewModel
@{
    ViewData["Title"] = "Upcoming Birthdays";
}

@section Styles
{
    <link rel="stylesheet" href="~/css/home.css" />
}

<div class="birthdays-container">
    <div class="today-birthdays">
        <h2>Today birthdays</h2>
        <div class="birthday-cards">
            @foreach (var birthday in Model.TodayBirthdays)
            {
                <div class="birthday-card">
                    <img src="/images/@birthday.Image" alt="@birthday.Name" class="avatar" />
                    <div class="birthday-info">
                        <h3>@birthday.Name</h3>
                        <p class="birthday-message">
                            @GetBirthdayMessage(birthday)
                        </p>
                    </div>
                </div>
            }
        </div>
    </div>

    <div class="near-birthdays">
        <h2>Upcoming birthdays in one week</h2>
        <div class="birthday-grid">
            @foreach (var birthday in Model.UpcomingBirthdays)
            {
                <div class="birthday-card">
                    <img src="/images/@birthday.Image" alt="@birthday.Name" class="avatar" />
                    <div class="birthday-info">
                        <h3>@birthday.Name</h3>
                        <p class="birthday-date">
                            @GetBirthdayMessage(birthday)
                        </p>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@functions {
    string GetBirthdayMessage(Birthday birthday)
    {
        var today = DateTime.Today;
        var nextBirthday = birthday.BirthdayDate.AddYears(today.Year - birthday.BirthdayDate.Year);
        if (nextBirthday < today) nextBirthday = nextBirthday.AddYears(1);

        int daysLeft = (nextBirthday - today).Days;
        int age = today.Year - birthday.BirthdayDate.Year;

        if (daysLeft == 0)
        {
            return "🎉Celebrates birthday TODAY!🎉";
        }

        if (daysLeft == 1)
        {
            return $"Will turn {age} TOMORROW! ({birthday.BirthdayDate:d})";
        }

        return $"Will turn {age} in {daysLeft} days ({birthday.BirthdayDate:d.MM})";
    }
}